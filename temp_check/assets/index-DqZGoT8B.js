const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Profile-CiLUDv9y.js","assets/vendor-ui-DJT7aDMV.js","assets/vendor-react-CkjGjP8g.js","assets/MainNav-BI9Tg7Ws.js","assets/button-DFN2cwgL.js","assets/vendor-utils-BiRAyoyP.js","assets/avatar-B-kwyh3e.js","assets/card-BRsmtwOm.js","assets/input-DGCO0cLz.js","assets/label-DyFGaCKG.js","assets/textarea-Bhu8nYPd.js","assets/separator-3trqgAOM.js","assets/badge-kBuOw4E9.js","assets/switch-xct-sQ_2.js","assets/vendor-supabase-0rZ8WFOd.js","assets/Settings-B2nzfnze.js","assets/tabs-B63PNTul.js","assets/select-BYXRlq8u.js","assets/GroupChatPage-sT2sLMW4.js","assets/dialog-D2QhPzNl.js","assets/Login-Cwce3FZT.js","assets/vendor-forms-D9wFpGa4.js","assets/alert-DOF9wRG0.js","assets/Register-Dau8Fqyl.js","assets/ForgotPassword-h8PkjC0M.js","assets/ResetPassword-acPY2x8S.js","assets/OptimizedChat-CVOrc7Rq.js","assets/Subscription-7Xb1UuYH.js","assets/Info-Dte1yX5h.js"])))=>i.map(i=>d[i]);
var be=Object.defineProperty;var we=(r,e,t)=>e in r?be(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var j=(r,e,t)=>we(r,typeof e!="symbol"?e+"":e,t);import{j as i,V as J,R as $,A as X,C as K,T as Y,D as G,P as ye}from"./vendor-ui-DJT7aDMV.js";import{a as Se,r as c,u as ve,B as xe,b as Ee,d as b,N as z,e as Ie}from"./vendor-react-CkjGjP8g.js";import{c as _e,_ as y}from"./vendor-supabase-0rZ8WFOd.js";import{t as je,c as ke,a as Pe,X as Ae}from"./vendor-utils-BiRAyoyP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const Oe="production",De=Oe==="production",U={SUPABASE_URL:"https://wqpoozpbceucynsojmbk.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndxcG9venBiY2V1Y3luc29qbWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1NjgzMDUsImV4cCI6MjA1NTE0NDMwNX0.vu1s86gQKEPXFleOZ1U2uOjW-kj4k4RAiKTbOuXPUD8"};try{typeof window<"u"&&(window.process={env:{}},window.process.env.NODE_ENV=De?"production":"development",window.process.env.SUPABASE_URL=U.SUPABASE_URL,window.process.env.SUPABASE_ANON_KEY=U.SUPABASE_ANON_KEY)}catch{}var W,B=Se;W=B.createRoot,B.hydrateRoot;const Ne="https://wqpoozpbceucynsojmbk.supabase.co",Re="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndxcG9venBiY2V1Y3luc29qbWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1NjgzMDUsImV4cCI6MjA1NTE0NDMwNX0.vu1s86gQKEPXFleOZ1U2uOjW-kj4k4RAiKTbOuXPUD8";class Z{static getInstance(){return this.instance||(this.instance=_e(Ne,Re,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!1},global:{headers:{"X-Client-Info":"snakkaz-chat","Content-Type":"application/json",Accept:"application/json"}}})),this.instance}static resetInstance(){this.instance=null}}j(Z,"instance",null);const O=Z.getInstance(),w=O,ze=()=>Math.random().toString(36).substring(2,9),H=()=>{const[r,e]=c.useState([]),t=c.useCallback(o=>{const a=ze(),d={id:a,...o};return e(l=>[...l,d]),a},[]);c.useEffect(()=>{if(typeof window<"u")return()=>{}},[t]);const n=c.useCallback(o=>{e(a=>a.filter(d=>d.id!==o))},[]),s=c.useCallback(()=>{e([])},[]);return{toast:t,dismiss:n,dismissAll:s,toasts:r}};class Te{async getSubscriptionPlans(){var e,t;try{const{data:n,error:s}=await w.from("subscription_plans").select("*").order("price",{ascending:!0});return s?((e=s.message)!=null&&e.includes("406")||(t=s.message)!=null&&t.includes("Not Acceptable")?(console.error("406 Not Acceptable error detected - this is likely a header issue:",s),console.info("Make sure the Supabase client has proper Accept: application/json headers")):console.error("Error fetching subscription plans:",s),s.code==="PGRST116"||s.code==="PGRST200"?(console.warn("Subscription_plans table may be missing, using fallback plans"),[{id:"basic",name:"Basic",price:0,interval:"monthly",features:{e2ee:!0,extended_storage:!1,premium_groups:!1}},{id:"premium",name:"Premium",price:5.99,interval:"monthly",features:{e2ee:!0,extended_storage:!0,premium_groups:!0,advanced_security:!0,file_sharing:!0},badge_text:"Popular",highlighted:!0}]):[]):n}catch(n){return console.error("Exception fetching subscription plans:",n),[]}}async getUserSubscription(e){var t,n;if(!e)return null;try{const{data:s,error:o}=await w.from("subscriptions").select("*, subscription_plans(*)").eq("user_id",e).eq("status","active").single();return o?(o.code!=="PGRST116"&&((t=o.message)!=null&&t.includes("406")||(n=o.message)!=null&&n.includes("Not Acceptable")?(console.error("406 Not Acceptable error detected - this is likely a header issue:",o),console.info("Make sure the Supabase client has proper Accept: application/json headers")):console.error("Error fetching user subscription:",o),o.code==="PGRST200"&&(console.warn("Subscription tables may be missing or have incorrect schema"),console.info("Run ./fix-subscription-schema.sh to fix database schema"))),null):s}catch(s){return console.error("Exception fetching subscription:",s),null}}async hasActivePremium(e){if(!e)return!1;try{const t=await this.getUserSubscription(e);return t===null?(console.info("No subscription found, using fallback basic features"),!1):!!t}catch(t){return console.error("Error checking active premium:",t),!1}}async createSubscription(e,t){if(!e||!t)return null;const n=new Date,s=new Date;s.setMonth(s.getMonth()+1);const{data:o,error:a}=await w.from("subscriptions").insert([{user_id:e,plan_id:t,status:"active",created_at:n.toISOString(),updated_at:n.toISOString(),current_period_end:s.toISOString()}]).select().single();return a?(console.error("Error creating subscription:",a),null):o}async cancelSubscription(e){if(!e)return!1;const{error:t}=await w.from("subscriptions").update({status:"canceled",updated_at:new Date().toISOString()}).eq("user_id",e).eq("status","active");return t?(console.error("Error canceling subscription:",t),!1):!0}async hasFeatureAccess(e,t){const n=await this.getUserSubscription(e);if(!n||!n.subscription_plans)return!1;const s=n.subscription_plans.features;return s&&s[t]===!0}async createTrialSubscription(e,t=14){if(!e)return!1;const{data:n,error:s}=await w.from("subscription_plans").select("id").eq("name","Premium").single();if(s||!n)return console.error("Error finding premium plan:",s),!1;const o=new Date,a=new Date;a.setDate(a.getDate()+t);const{error:d}=await w.from("subscriptions").insert([{user_id:e,plan_id:n.id,status:"trial",created_at:o.toISOString(),updated_at:o.toISOString(),current_period_end:a.toISOString()}]);return d?(console.error("Error creating trial subscription:",d),!1):!0}async isSubscriptionExpiringSoon(e,t=5){const n=await this.getUserSubscription(e);if(!n)return!1;const s=new Date(n.current_period_end),o=new Date,a=s.getTime()-o.getTime(),d=Math.ceil(a/(1e3*60*60*24));return d<=t&&d>=0}}const M=new Te,Q=c.createContext(void 0),Ce=({children:r})=>{const[e,t]=c.useState(null),[n,s]=c.useState(null),[o,a]=c.useState(null),[d,l]=c.useState(!0),[T,x]=c.useState(!1),[de,A]=c.useState(null),{toast:E}=H(),C=ve(),R=async()=>{if(e){x(!0);try{const f=await M.getUserSubscription(e.id);a(f)}catch(f){console.error("Error loading subscription:",f)}finally{x(!1)}}};c.useEffect(()=>{(async()=>{l(!0);try{const{data:g,error:p}=await w.auth.getSession();if(p)throw p;g!=null&&g.session&&(s(g.session),t(g.session.user))}catch(g){console.error("Error loading user:",g),A("Could not load user profile")}finally{l(!1)}})();const{data:h}=w.auth.onAuthStateChange(async(g,p)=>{p?(s(p),t(p.user)):(s(null),t(null),a(null)),l(!1)});return()=>{h==null||h.subscription.unsubscribe()}},[]),c.useEffect(()=>{e&&R()},[e,R]),c.useEffect(()=>{const f=async()=>{if(!e)return;if(await M.isSubscriptionExpiringSoon(e.id)&&o){const I=new Date(o.current_period_end||"").toLocaleDateString();E({title:"Subscription Expiring Soon",description:`Your premium subscription will expire on ${I}. Renew now to avoid losing premium features.`,variant:"warning",duration:1e4})}};f();const h=setInterval(f,24*60*60*1e3);return()=>clearInterval(h)},[o,E,e]);const pe=async(f,h)=>{try{l(!0);const{data:g,error:p}=await w.auth.signInWithPassword({email:f,password:h});if(p)throw p;s(g.session),t(g.user),C("/chat"),E({title:"Innlogging vellykket",description:"Velkommen tilbake!"})}catch(g){const p=g instanceof Error?g.message:"Unknown error occurred";console.error("Innloggingsfeil:",p),A(p),E({variant:"destructive",title:"Innloggingsfeil",description:p||"Kunne ikke logge inn. Sjekk påloggingsinformasjonen."})}finally{l(!1)}},fe=async()=>{try{l(!0);const{error:f}=await w.auth.signOut();if(f)throw f;s(null),t(null),a(null),C("/"),E({title:"Utlogget",description:"Du har blitt logget ut."})}catch(f){const h=f instanceof Error?f.message:"Unknown error occurred";console.error("Utloggingsfeil:",h),A(h),E({variant:"destructive",title:"Utloggingsfeil",description:h||"Kunne ikke logge ut. Prøv igjen."})}finally{l(!1)}},ge=async(f,h,g={})=>{try{l(!0);const{data:p,error:I}=await w.auth.signUp({email:f,password:h,options:{data:g}});if(I)throw I;E({title:"Registrering vellykket",description:"Sjekk e-posten din for bekreftelseslenke."})}catch(p){const I=p instanceof Error?p.message:"Unknown error occurred";console.error("Registreringsfeil:",I),A(I),E({variant:"destructive",title:"Registreringsfeil",description:I||"Kunne ikke opprette konto. Prøv igjen."})}finally{l(!1)}},me=!!o&&(o.status==="active"||o.status==="trial"),he={user:e,session:n,subscription:o,signIn:pe,signOut:fe,signUp:ge,loading:d,loadingSubscription:T,error:de,isAuthenticated:!!e,isPremium:me,refreshSubscription:R};return i.jsx(Q.Provider,{value:he,children:r})},Ue=()=>{const r=c.useContext(Q);if(r===void 0)throw new Error("useAuth må brukes innenfor en AuthProvider");return r};function k(...r){return je(ke(r))}const Be=ye,ee=c.forwardRef(({className:r,...e},t)=>i.jsx(J,{ref:t,className:k("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...e}));ee.displayName=J.displayName;const Me=Pe("data-[swipe=move]:transition-none group relative pointer-events-auto flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:slide-out-to-right-full",{variants:{variant:{default:"bg-background border",destructive:"group destructive border-destructive bg-destructive text-destructive-foreground",warning:"group warning border-warning bg-warning text-warning-foreground",success:"group success border-green-700 bg-green-900 text-green-200"}},defaultVariants:{variant:"default"}}),te=c.forwardRef(({className:r,variant:e,...t},n)=>i.jsx($,{ref:n,className:k(Me({variant:e}),r),...t}));te.displayName=$.displayName;const Le=c.forwardRef(({className:r,...e},t)=>i.jsx(X,{ref:t,className:k("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-destructive/30 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...e}));Le.displayName=X.displayName;const re=c.forwardRef(({className:r,...e},t)=>i.jsx(K,{ref:t,className:k("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...e,children:i.jsx(Ae,{className:"h-4 w-4"})}));re.displayName=K.displayName;const se=c.forwardRef(({className:r,...e},t)=>i.jsx(Y,{ref:t,className:k("text-sm font-semibold",r),...e}));se.displayName=Y.displayName;const ne=c.forwardRef(({className:r,...e},t)=>i.jsx(G,{ref:t,className:k("text-sm opacity-90",r),...e}));ne.displayName=G.displayName;function Fe(){const{toasts:r}=H(),e=Array.isArray(r)?r:[];return i.jsxs(Be,{children:[e.map(function({id:t,title:n,description:s,action:o,...a}){return i.jsxs(te,{...a,children:[i.jsxs("div",{className:"grid gap-1",children:[n&&i.jsx(se,{children:n}),s&&i.jsx(ne,{children:s})]}),o,i.jsx(re,{})]},t)}),i.jsx(ee,{})]})}const qe=!0,oe=()=>{try{return!!w&&qe}catch(r){return console.error("Error verifying Supabase configuration:",r),!1}};oe();function ie(){if(typeof document>"u")return;const r=window.location.hostname==="localhost",e={"default-src":["'self'"],"script-src":r?["'self'","'unsafe-inline'","'unsafe-eval'","cdn.gpteng.co"]:["'self'","cdn.gpteng.co","'sha256-1SuipMDplXoKeoH5h0AccIQrF7qwRCEFPCuoNSA6NrM='","'sha256-hR8LUoFSvUqLEELJErbmI2vwnXpAjz1dpHxy2vpLRKQ='"],"style-src":["'self'","'unsafe-inline'"],"img-src":["'self'","data:","blob:","*.amazonaws.com","storage.googleapis.com","*.supabase.co","*.supabase.in","secure.gravatar.com"],"font-src":["'self'","data:"],"connect-src":["'self'","*.supabase.co","*.supabase.in","wss://*.supabase.co","*.amazonaws.com","storage.googleapis.com","*.snakkaz.com","dash.snakkaz.com","business.snakkaz.com","docs.snakkaz.com","analytics.snakkaz.com","mcp.snakkaz.com","help.snakkaz.com","cdn.gpteng.co"],"media-src":["'self'","blob:"],"object-src":["'none'"],"frame-src":["'self'"],"worker-src":["'self'","blob:"],"form-action":["'self'"],"base-uri":["'self'"],"frame-ancestors":["'self'"],...r?{}:{"require-trusted-types-for":["'script'"]},"upgrade-insecure-requests":[],...r?{}:{"report-to":["csp-endpoint"]}},t=Object.entries(e).map(([n,s])=>s.length===0?n:`${n} ${s.join(" ")}`).join("; ");try{const n=document.querySelector('meta[http-equiv="Content-Security-Policy"]'),s=r?"Content-Security-Policy":"Content-Security-Policy-Report-Only";if(n)n.setAttribute("content",t),n.setAttribute("http-equiv",s);else{const o=document.createElement("meta");o.setAttribute("http-equiv",s),o.setAttribute("content",t);const a=document.head||document.getElementsByTagName("head")[0];a.firstChild?a.insertBefore(o,a.firstChild):a.appendChild(o)}r||Ve(),console.log(`CSP policy applied successfully in ${r?"development":"production"} mode`)}catch(n){console.error("Failed to apply CSP policy:",n)}}function Ve(){if(!(typeof window>"u"))if("ReportingObserver"in window){const r="https://analytics.snakkaz.com/api/csp-report";try{navigator.sendBeacon(r,JSON.stringify({type:"csp-endpoint-test",message:"CSP reporting initialized",timestamp:Date.now()}))}catch(e){console.warn("CSP reporting test failed:",e)}}else console.warn("ReportingObserver not supported in this browser. CSP violations will not be reported.")}const Je="snakkaz-storage",L=1,_=class _{constructor(){j(this,"database",null);j(this,"isInitializing",!1);j(this,"initPromise",null)}static getInstance(){return _.instance||(_.instance=new _),_.instance}async init(){return this.database?this.database:this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{if(!window.indexedDB){t(new Error("IndexedDB is not supported in this browser"));return}console.log("[IndexedDB] Opening database...");const n=window.indexedDB.open(Je,L);n.onupgradeneeded=s=>{console.log(`[IndexedDB] Upgrading database to version ${L}`);const o=s.target.result;if(!o.objectStoreNames.contains("messages")){const a=o.createObjectStore("messages",{keyPath:"id"});a.createIndex("status","status",{unique:!1}),a.createIndex("recipientId","recipientId",{unique:!1}),a.createIndex("groupId","groupId",{unique:!1}),a.createIndex("createdAt","createdAt",{unique:!1})}o.objectStoreNames.contains("media")||o.createObjectStore("media",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),o.objectStoreNames.contains("settings")||o.createObjectStore("settings",{keyPath:"key"})},n.onsuccess=s=>{this.database=s.target.result,console.log(`[IndexedDB] Database opened successfully, version ${this.database.version}`),this.database.onerror=o=>{console.error("[IndexedDB] Database error:",o)},e(this.database)},n.onerror=s=>{console.error("[IndexedDB] Error opening database:",s.target.error),this.initPromise=null,t(s.target.error)}}),this.initPromise)}async add(e,t){const n=await this.init();return new Promise((s,o)=>{const l=n.transaction([e],"readwrite").objectStore(e).add(t);l.onsuccess=()=>{s(l.result)},l.onerror=()=>{console.error(`[IndexedDB] Error adding item to ${e}:`,l.error),o(l.error)}})}async get(e,t){const n=await this.init();return new Promise((s,o)=>{const l=n.transaction([e],"readonly").objectStore(e).get(t);l.onsuccess=()=>{s(l.result||null)},l.onerror=()=>{console.error(`[IndexedDB] Error getting item from ${e}:`,l.error),o(l.error)}})}async getAll(e){const t=await this.init();return new Promise((n,s)=>{const d=t.transaction([e],"readonly").objectStore(e).getAll();d.onsuccess=()=>{n(d.result)},d.onerror=()=>{console.error(`[IndexedDB] Error getting all items from ${e}:`,d.error),s(d.error)}})}async put(e,t){const n=await this.init();return new Promise((s,o)=>{const l=n.transaction([e],"readwrite").objectStore(e).put(t);l.onsuccess=()=>{s()},l.onerror=()=>{console.error(`[IndexedDB] Error updating item in ${e}:`,l.error),o(l.error)}})}async delete(e,t){const n=await this.init();return new Promise((s,o)=>{const l=n.transaction([e],"readwrite").objectStore(e).delete(t);l.onsuccess=()=>{s()},l.onerror=()=>{console.error(`[IndexedDB] Error deleting item from ${e}:`,l.error),o(l.error)}})}async getByIndex(e,t,n){const s=await this.init();return new Promise((o,a)=>{const x=s.transaction([e],"readonly").objectStore(e).index(t).getAll(n);x.onsuccess=()=>{o(x.result)},x.onerror=()=>{console.error(`[IndexedDB] Error getting items by index ${t} from ${e}:`,x.error),a(x.error)}})}async clear(e){const t=await this.init();return new Promise((n,s)=>{const d=t.transaction([e],"readwrite").objectStore(e).clear();d.onsuccess=()=>{n()},d.onerror=()=>{console.error(`[IndexedDB] Error clearing ${e}:`,d.error),s(d.error)}})}static isSupported(){return!!window.indexedDB}};j(_,"instance");let S=_;const m=S.getInstance();let F=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const D=100,v="snakkaz_offline_messages";async function vt(){try{if(S.isSupported())return await m.getAll("messages");{const r=localStorage.getItem(v);return r?JSON.parse(r).messages||[]:[]}}catch(r){return console.error("[OfflineMessageStore] Failed to get offline messages:",r),[]}}async function xt(r,e){try{const t={id:F(),text:r,recipientId:e.recipientId,groupId:e.groupId,mediaType:e.mediaType,mediaName:e.mediaName,ttl:e.ttl,createdAt:Date.now(),status:"pending",retryCount:0};if(e.mediaBlob&&S.isSupported())try{const n=F();await m.add("media",{id:n,blob:e.mediaBlob,type:e.mediaType||"application/octet-stream",name:e.mediaName||"attachment",size:e.mediaBlob.size,createdAt:Date.now()}),t.mediaId=n}catch(n){console.error("[OfflineMessageStore] Failed to store media:",n)}if(S.isSupported())try{const n=await m.getAll("messages");if(n.length>=D){const s=[...n].sort((o,a)=>o.createdAt-a.createdAt);for(let o=0;o<n.length-D+1;o++){const a=s[o];await m.delete("messages",a.id),a.mediaId&&await m.delete("media",a.mediaId)}}await m.add("messages",t)}catch(n){console.error("[OfflineMessageStore] IndexedDB error:",n),q(t)}else q(t);return t}catch(t){throw console.error("[OfflineMessageStore] Failed to save offline message:",t),t}}async function Et(r,e,t){try{if(S.isSupported()){const n=await m.get("messages",r);n&&(n.status=e,t!==void 0&&(n.retryCount=t),await m.put("messages",n))}else{const n=localStorage.getItem(v);if(!n)return;const s=JSON.parse(n),o=s.messages.findIndex(a=>a.id===r);o!==-1&&(s.messages[o].status=e,t!==void 0&&(s.messages[o].retryCount=t),localStorage.setItem(v,JSON.stringify(s)))}}catch(n){console.error("[OfflineMessageStore] Failed to update message status:",n)}}async function It(r){try{if(S.isSupported()){const e=await m.get("messages",r);e&&(e.mediaId&&await m.delete("media",e.mediaId),await m.delete("messages",r))}else{const e=localStorage.getItem(v);if(!e)return;const t=JSON.parse(e),n=t.messages.findIndex(s=>s.id===r);n!==-1&&(t.messages.splice(n,1),localStorage.setItem(v,JSON.stringify(t)))}}catch(e){console.error("[OfflineMessageStore] Failed to remove message:",e)}}async function _t(r){try{if(!S.isSupported())return null;const e=await m.get("media",r);return e?e.blob:null}catch(e){return console.error("[OfflineMessageStore] Failed to get message media:",e),null}}function q(r){try{const e=localStorage.getItem(v),t=e?JSON.parse(e):{messages:[],lastSyncedAt:null};t.messages.length>=D&&(t.messages=t.messages.slice(-D+1));const n={...r};delete n.mediaId,t.messages.push(n),localStorage.setItem(v,JSON.stringify(t))}catch(e){console.error("[OfflineMessageStore] Failed to use localStorage fallback:",e)}}async function ae(){try{if(!S.isSupported())return;const r=localStorage.getItem(v);if(!r)return;const e=JSON.parse(r);if(!e.messages||!Array.isArray(e.messages))return;for(const t of e.messages)await m.add("messages",t);localStorage.removeItem(v),console.log("[OfflineMessageStore] Successfully migrated from localStorage to IndexedDB")}catch(r){console.error("[OfflineMessageStore] Failed to migrate from localStorage:",r)}}typeof window<"u"&&ae();async function $e(){if(console.log("Initializing security features..."),ie(),S.isSupported())try{await m.init(),console.log("IndexedDB storage initialized successfully"),await ae()}catch(r){console.error("Failed to initialize IndexedDB storage:",r)}else console.warn("IndexedDB is not supported in this browser. Using localStorage fallback.");typeof window<"u"&&window.location.protocol==="https:"&&Xe()}function Xe(){if(typeof document>"u")return;[{name:"referrer",content:"strict-origin-when-cross-origin"},{name:"X-Frame-Options",content:"SAMEORIGIN"},{httpEquiv:"X-Content-Type-Options",content:"nosniff"}].forEach(e=>{const t=document.createElement("meta");e.name&&(t.name=e.name),e.httpEquiv&&(t.httpEquiv=e.httpEquiv),t.content=e.content,document.head.appendChild(t)})}async function Ke(){try{console.log("Initializing Snakkaz security features..."),ie(),await $e(),console.log("Security features initialized successfully")}catch(r){console.error("Failed to initialize security features:",r)}}var V={};const N={production:!0,supabase:{url:"https://wqpoozpbceucynsojmbk.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndxcG9venBiY2V1Y3luc29qbWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1NjgzMDUsImV4cCI6MjA1NTE0NDMwNX0.vu1s86gQKEPXFleOZ1U2uOjW-kj4k4RAiKTbOuXPUD8",customDomain:null},app:{name:"Snakkaz",version:"1.0.0",baseUrl:"https://www.snakkaz.com"}};function ce(){try{const r=typeof process<"u"&&V&&V.SUPABASE_BRANCH;return r?(console.log(`Using Supabase Preview branch: ${r}`),N.supabase.preview={enabled:!0,branch:r},!0):(console.log("Using main Supabase instance"),!1)}catch(r){return console.error("Failed to check Supabase Preview status:",r),!1}}const jt=Object.freeze(Object.defineProperty({__proto__:null,checkSupabasePreviewStatus:ce,environment:N},Symbol.toStringTag,{value:"Module"}));let u=null;async function Ye(){if(u)return u;const r=He(),e=typeof sessionStorage<"u"?sessionStorage.getItem("SUPABASE_PREVIEW_BRANCH"):null;(r||e)&&typeof sessionStorage<"u"&&r&&sessionStorage.setItem("SUPABASE_PREVIEW_BRANCH",r);const t=ce();let n=null;if(t&&"preview"in N.supabase&&(n=N.supabase.preview.branch),u={enabled:t,branch:n,connectionStatus:"unknown"},!t){try{const{error:s}=await O.auth.getSession();u.connectionStatus=s?"error":"connected",s&&(u.error=`Regular connection error: ${s.message}`,console.error("Supabase connection error:",s.message))}catch(s){u.connectionStatus="error",u.error=`Unexpected error: ${s instanceof Error?s.message:"Unknown error"}`,console.error("Supabase unexpected error:",s)}return u}try{const{error:s}=await Ge();s?(u.connectionStatus="error",u.error=`Preview connection error: ${s}`,console.error("Supabase preview connection error:",s)):(u.connectionStatus="connected",console.log(`Successfully connected to Supabase preview branch: ${u.branch}`))}catch(s){u.connectionStatus="error",u.error=`Unexpected error: ${s instanceof Error?s.message:"Unknown error"}`,console.error("Supabase preview unexpected error:",s)}return u}async function Ge(){try{const{error:r}=await O.auth.getSession();if(r)return{error:`Auth error: ${r.message}`};const{error:e}=await O.from("profiles").select("id").limit(1);return e?{error:`Database error: ${e.message}`}:{error:null}}catch(r){return{error:r instanceof Error?r.message:"Unknown error"}}}async function We(){return await Ye()}function le(){return!!(u!=null&&u.enabled&&(u!=null&&u.branch)&&(u==null?void 0:u.connectionStatus)==="connected")}function Ze(){const r=(u==null?void 0:u.branch)||"",e=r.startsWith("pr-");let t;if(e){const n=r.match(/^pr-(\d+)$/);n&&n[1]&&(t=parseInt(n[1],10))}return{branch:r,isPreview:!!(u!=null&&u.enabled),isPR:e,prNumber:t,label:e?`PR #${t}`:r||"Main"}}function He(){if(typeof window>"u")return null;try{return new URL(window.location.href).searchParams.get("supabase_branch")}catch{return null}}const Qe=()=>{if(!le())return null;const r=Ze();return i.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-amber-600 text-black p-2 text-xs sm:text-sm text-center z-50",children:r.isPR?`Testing Preview Environment for PR #${r.prNumber}`:`Testing Preview Environment: ${r.branch}`})},et=()=>{const[r,e]=c.useState(!1);return null},tt=c.lazy(()=>y(()=>import("./Profile-CiLUDv9y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),rt=c.lazy(()=>y(()=>import("./Settings-B2nzfnze.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,16,13,9,17,11,12,14]))),st=c.lazy(()=>y(()=>import("./GroupChatPage-sT2sLMW4.js"),__vite__mapDeps([18,1,2,7,6,5,4,10,9,8,16,12,19,17,13,14]))),nt=c.lazy(()=>y(()=>import("./Login-Cwce3FZT.js"),__vite__mapDeps([20,1,2,21,22,9,5,4,8,7,14]))),ot=c.lazy(()=>y(()=>import("./Register-Dau8Fqyl.js"),__vite__mapDeps([23,1,2,21,22,9,5,4,8,7,14]))),it=c.lazy(()=>y(()=>import("./ForgotPassword-h8PkjC0M.js"),__vite__mapDeps([24,1,2,21,22,9,5,4,8,7,14]))),at=c.lazy(()=>y(()=>import("./ResetPassword-acPY2x8S.js"),__vite__mapDeps([25,1,2,21,22,9,5,4,8,7,14]))),ct=c.lazy(()=>y(()=>import("./OptimizedChat-CVOrc7Rq.js"),__vite__mapDeps([26,1,2,3,4,5,6,14]))),lt=c.lazy(()=>y(()=>import("./Subscription-7Xb1UuYH.js"),__vite__mapDeps([27,1,2,16,7,12,5,4,19,11,14]))),ut=()=>i.jsx("div",{className:"h-screen flex items-center justify-center bg-cyberdark-950",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cybergold-500 mb-4"}),i.jsx("p",{className:"text-cybergold-400",children:"Laster inn..."})]})}),dt=({resetApp:r})=>i.jsx("div",{className:"h-screen flex items-center justify-center bg-black",children:i.jsxs("div",{className:"flex flex-col items-center max-w-md p-6 bg-gray-900 rounded-lg shadow-lg",children:[i.jsx("h2",{className:"text-xl text-yellow-400 mb-4",children:"Noe gikk galt"}),i.jsx("p",{className:"text-white mb-4",children:"Vi beklager, men det har oppstått en feil i Snakkaz Chat."}),i.jsx("button",{onClick:r,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-black font-medium rounded",children:"Last siden på nytt"})]})});function pt({children:r}){const[e,t]=c.useState(!1);c.useEffect(()=>{const s=()=>{t(!0)};return window.addEventListener("error",s),window.addEventListener("unhandledrejection",s),()=>{window.removeEventListener("error",s),window.removeEventListener("unhandledrejection",s)}},[]);const n=()=>{window.location.reload()};return e?i.jsx(dt,{resetApp:n}):r}const P=({children:r})=>{const{user:e}=Ue(),t=Ie();return e?r:i.jsx(z,{to:"/login",state:{from:t},replace:!0})},ft=()=>{try{y(()=>import("./Profile-CiLUDv9y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),y(()=>import("./Settings-B2nzfnze.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,16,13,9,17,11,12,14]))}catch{}};function gt(){const[r,e]=c.useState(!1);return c.useEffect(()=>{(async()=>{try{await Ke(),console.log("Security features initialized"),oe();const n=await We();e(le()),n.enabled&&console.log("Running in Supabase preview environment:",n.branch)}catch(n){console.error("Failed to initialize application:",n)}})()},[]),c.useEffect(()=>{ft()},[]),i.jsx(pt,{children:i.jsx(xe,{children:i.jsxs(Ce,{children:[r&&i.jsx(Qe,{}),i.jsx(c.Suspense,{fallback:i.jsx(ut,{}),children:i.jsxs(Ee,{children:[i.jsx(b,{path:"/login",element:i.jsx(nt,{})}),i.jsx(b,{path:"/register",element:i.jsx(ot,{})}),i.jsx(b,{path:"/forgot-password",element:i.jsx(it,{})}),i.jsx(b,{path:"/reset-password",element:i.jsx(at,{})}),i.jsx(b,{path:"/info",element:c.lazy(()=>y(()=>import("./Info-Dte1yX5h.js"),__vite__mapDeps([28,1,2,4,5,14])))}),i.jsx(b,{path:"/chat/*",element:i.jsx(P,{children:i.jsx(ct,{})})}),i.jsx(b,{path:"/profile",element:i.jsx(P,{children:i.jsx(tt,{})})}),i.jsx(b,{path:"/settings",element:i.jsx(P,{children:i.jsx(rt,{})})}),i.jsx(b,{path:"/group/:id",element:i.jsx(P,{children:i.jsx(st,{})})}),i.jsx(b,{path:"/subscription",element:i.jsx(P,{children:i.jsx(lt,{})})}),i.jsx(b,{path:"/",element:i.jsx(z,{to:"/chat",replace:!0})}),i.jsx(b,{path:"*",element:i.jsx(z,{to:"/chat",replace:!0})})]})}),i.jsx(Fe,{}),i.jsx(et,{})]})})})}const ue=r=>{try{console.log("Global error handlers initialized")}catch{}return!0};window.addEventListener("error",ue);window.addEventListener("unhandledrejection",ue);function mt(){try{const r=document.getElementById("root");if(!r){document.body.innerHTML='<div style="padding: 20px; text-align: center;"><h2>Laster Snakkaz Chat...</h2><p>Kunne ikke finne root-element. Vennligst last inn siden på nytt.</p><button onclick="window.location.reload()">Last inn på nytt</button></div>';return}W(r).render(i.jsx(gt,{})),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(n=>{n.unregister()})})}catch{document.body.innerHTML='<div style="padding: 20px; text-align: center;"><h2>Snakkaz Chat</h2><p>Vi beklager, men det oppstod et problem ved lasting av appen.</p><button onclick="window.location.reload()" style="padding: 8px 16px; margin-top: 20px;">Last inn på nytt</button></div>'}}mt();export{S as I,H as a,xt as b,k as c,Et as d,_t as e,w as f,vt as g,M as h,m as i,N as j,jt as k,F as n,It as r,O as s,Ue as u};
