import{j as e}from"./vendor-ui-DJT7aDMV.js";import{u as E,r as a,L as f}from"./vendor-react-CkjGjP8g.js";import{u as z,z as i}from"./vendor-forms-D9wFpGa4.js";import{A as B,a as I,F as V,b as u,c as k,d as y,e as j,f as w,t as D}from"./alert-DOF9wRG0.js";import{a as _,f as c}from"./index-DqZGoT8B.js";import{B as M}from"./button-DFN2cwgL.js";import{I as N}from"./input-DGCO0cLz.js";import{C as O,a as R,b as U,d as H,c as K,e as Z}from"./card-BRsmtwOm.js";import{ab as q,i as v,ac as G}from"./vendor-utils-BiRAyoyP.js";import"./label-DyFGaCKG.js";import"./vendor-supabase-0rZ8WFOd.js";const J=i.object({password:i.string().min(8,{message:"Passord må være minst 8 tegn."}).regex(/[A-Z]/,{message:"Passord må inneholde minst én stor bokstav."}).regex(/[0-9]/,{message:"Passord må inneholde minst ett tall."}).regex(/[^a-zA-Z0-9]/,{message:"Passord må inneholde minst ett spesialtegn."}),confirmPassword:i.string()}).refine(o=>o.password===o.confirmPassword,{message:"Passordene samsvarer ikke.",path:["confirmPassword"]}),ne=()=>{const{toast:o}=_(),P=E(),[n,S]=a.useState(!1),[d,t]=a.useState(null),[m,g]=a.useState(!1),[F,x]=a.useState(!1),l=z({resolver:D(J),defaultValues:{password:"",confirmPassword:""}});a.useEffect(()=>{(async()=>{const{data:s,error:p}=await c.auth.getSession();if(p){console.error("Session error:",p),t("Kunne ikke verifisere tilbakestillingsforespørselen. Token kan være utløpt eller ugyldig.");return}if(s&&s.session)x(!0);else{const C=window.location.hash.substring(1),b=new URLSearchParams(C),h=b.get("access_token"),L=b.get("refresh_token");if(h)try{await c.auth.setSession({access_token:h,refresh_token:L||""}),x(!0)}catch(A){console.error("Error setting session:",A),t("Ugyldig eller utløpt tilbakestillingslenke. Be om en ny lenke.")}else t("Ingen gyldig tilbakestillingstoken funnet. Vennligst be om en ny tilbakestillingslenke.")}})()},[]);const T=async r=>{g(!0),t(null);try{const{error:s}=await c.auth.updateUser({password:r.password});if(s)throw s;o({title:"Passord oppdatert",description:"Ditt passord har blitt oppdatert. Du kan nå logge inn med ditt nye passord."}),setTimeout(()=>{P("/")},2e3)}catch(s){console.error("Password reset error:",s),t(s.message||"Kunne ikke oppdatere passord. Vennligst prøv igjen senere.")}finally{g(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-cyberdark-950",children:e.jsxs("div",{className:"w-full max-w-md px-4",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("img",{src:"/logos/snakkaz-gold.svg",alt:"Snakkaz Logo",className:"h-16 w-auto",onError:r=>{const s=r.target;s.onerror=null,s.src="/logos/snakkaz-gold.png"}})}),e.jsxs(O,{className:"border-cybergold-600/20 bg-cyberdark-900",children:[e.jsxs(R,{className:"space-y-1",children:[e.jsx(U,{className:"text-center text-2xl font-bold text-cybergold-400",children:"Tilbakestill passord"}),e.jsx(H,{className:"text-center text-cybergold-600",children:"Opprett et nytt passord for kontoen din"})]}),e.jsxs(K,{children:[d&&e.jsxs(B,{variant:"destructive",className:"mb-4 bg-red-900/40 border-red-800",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(I,{children:d})]}),F?e.jsx(V,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(T),className:"space-y-4",children:[e.jsx(u,{control:l.control,name:"password",render:({field:r})=>e.jsxs(k,{children:[e.jsx(y,{className:"text-cybergold-300",children:"Nytt passord"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-cybergold-500"}),e.jsx(j,{children:e.jsx(N,{type:n?"text":"password",placeholder:"••••••••",className:"pl-10 bg-cyberdark-800 border-cyberdark-700 text-cybergold-200",...r})}),e.jsx("button",{type:"button",className:"absolute right-3 top-3 text-xs text-cybergold-500 hover:text-cybergold-400",onClick:()=>S(!n),children:n?"Skjul":"Vis"})]}),e.jsx(w,{className:"text-red-400"})]})}),e.jsx(u,{control:l.control,name:"confirmPassword",render:({field:r})=>e.jsxs(k,{children:[e.jsx(y,{className:"text-cybergold-300",children:"Bekreft nytt passord"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-cybergold-500"}),e.jsx(j,{children:e.jsx(N,{type:n?"text":"password",placeholder:"••••••••",className:"pl-10 bg-cyberdark-800 border-cyberdark-700 text-cybergold-200",...r})})]}),e.jsx(w,{className:"text-red-400"})]})}),e.jsx(M,{type:"submit",className:"w-full bg-cybergold-600 text-black hover:bg-cybergold-500",disabled:m,children:m?"Oppdaterer...":"Oppdater passord"})]})}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-cybergold-500 mb-6",children:"Venter på verifisering av tilbakestillingsforespørselen..."}),e.jsx(f,{to:"/forgot-password",className:"text-cybergold-400 hover:text-cybergold-300 underline underline-offset-4",children:"Be om en ny tilbakestillingslenke"})]})]}),e.jsx(Z,{className:"flex justify-center",children:e.jsxs(f,{to:"/",className:"inline-flex items-center text-cybergold-500 hover:text-cybergold-400 transition-colors",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Tilbake til innlogging"]})})]})]})})};export{ne as default};
