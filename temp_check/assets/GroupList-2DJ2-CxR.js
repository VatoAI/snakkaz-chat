const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/offlinePageEncryption-Bbo2BKkO.js","assets/vendor-supabase-0rZ8WFOd.js","assets/vendor-react-CkjGjP8g.js"])))=>i.map(i=>d[i]);
var he=Object.defineProperty;var we=(l,t,r)=>t in l?he(l,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[t]=r;var S=(l,t,r)=>we(l,typeof t!="symbol"?t+"":t,r);import{j as i}from"./vendor-ui-DJT7aDMV.js";import{r as f}from"./vendor-react-CkjGjP8g.js";import{j as oe,s as D}from"./index-DqZGoT8B.js";import{_ as B}from"./vendor-supabase-0rZ8WFOd.js";import{g as ie,d as $,s as J,e as R,a as _,b as M,c as O,f as H,h as z,K as h,i as j,j as w,k as T,l as Q,m as Ee,n as be,o as ke}from"./group-e2ee-COJTg87O.js";import{B as W}from"./button-DFN2cwgL.js";import{D as xe,a as ve,b as Se,c as De,e as Ae}from"./dialog-D2QhPzNl.js";import{S as Ne,a as Ie,b as _e,c as Me,d as q}from"./select-BYXRlq8u.js";import{I as te}from"./input-DGCO0cLz.js";import{L as re}from"./label-DyFGaCKG.js";import{A as $e}from"./avatar-B-kwyh3e.js";import{i as X,m as ce,at as ae,a8 as je,d as de,au as Ke,av as Ge,a9 as Pe,y as Ce,aw as Re,p as Oe,G as Te}from"./vendor-utils-BiRAyoyP.js";const A=new Map,Fe=async(l,t)=>{const r=l==="standard"?128:256,e=await Q(r,!0),a=await j(e),n=z(16);return A.set(n,e),JSON.stringify({id:n,jwk:a,algorithm:w.AES_GCM,length:r,timestamp:Date.now()})},Le=async(l,t,r)=>{try{const e=JSON.parse(t);let a;A.has(e.id)?a=A.get(e.id):(a=await T(e.jwk,w.AES_GCM,[h.ENCRYPT,h.DECRYPT],!0),A.set(e.id,a));const{encryptedData:n,iv:s}=await R(l,a);return JSON.stringify({ciphertext:_(n),iv:_(s),keyId:e.id,algorithm:w.AES_GCM,type:r})}catch(e){throw console.error("Encryption failed:",e),new Error(`Encryption failed: ${e instanceof Error?e.message:"Unknown error"}`)}},Ue=async(l,t)=>{try{const r=JSON.parse(l),e=JSON.parse(t);let a;if(A.has(e.id)?a=A.get(e.id):(a=await T(e.jwk,w.AES_GCM,[h.ENCRYPT,h.DECRYPT],!0),A.set(e.id,a)),r.keyId&&r.keyId!==e.id)throw new Error("Key ID mismatch");const n=M(r.ciphertext),s=M(r.iv),o=await O(n,a,s);return H(o)}catch(r){throw console.error("Decryption failed:",r),new Error(`Decryption failed: ${r instanceof Error?r.message:"Unknown error"}`)}};var C=(l=>(l.STANDARD="STANDARD",l.E2EE="E2EE",l.P2P_E2EE="P2P_E2EE",l))(C||{}),le=(l=>(l.MESSAGE="MESSAGE",l.WHOLE_PAGE="WHOLE_PAGE",l.FILE="FILE",l.USER_DATA="USER_DATA",l))(le||{});const Be={intervalDays:30,autoRotate:!0,retainPreviousKeys:3};let ee=class{constructor(t={}){S(this,"keyRotationPolicy");S(this,"keyHistory",new Map);this.keyRotationPolicy={...Be,...t}}isOnCustomDomain(){var e,a;const t=window.location.hostname,r=((a=(e=oe)==null?void 0:e.supabase)==null?void 0:a.customDomain)||"www.snakkaz.com";return t===r||t===r.replace("www.","")}getRecommendedSecurityLevel(t){if(this.isOnCustomDomain())switch(t){case"MESSAGE":case"USER_DATA":return"E2EE";case"FILE":case"WHOLE_PAGE":return"P2P_E2EE";default:return"E2EE"}switch(t){case"MESSAGE":return"E2EE";case"USER_DATA":return"STANDARD";case"FILE":case"WHOLE_PAGE":return"E2EE";default:return"STANDARD"}}async encrypt(t,r="E2EE",e="MESSAGE",a,n){try{const s=typeof t=="object"?JSON.stringify(t):t,{key:o,keyId:c}=a?{key:a,keyId:this.generateKeyId()}:await this.generateKey(r,e);return a||this.keyHistory.set(c,{key:o,createdAt:Date.now()}),{encryptedData:await Le(s,o,e),keyId:c,securityLevel:r,timestamp:Date.now(),metadata:{encryptionType:e,version:"1.2",...n}}}catch(s){throw console.error("Encryption failed:",s),new Error(`Failed to encrypt data: ${s.message}`)}}async decrypt(t,r,e){try{const a=await Ue(t,r);try{return JSON.parse(a)}catch{return console.debug("JSON parsing failed during decryption, returning raw data"),a}}catch(a){throw console.error("Decryption failed:",a),new Error(`Failed to decrypt data: ${a.message}`)}}async encryptWithPassword(t,r){try{const e=ie(),a=await $(r,e),n=J(t),s=window.crypto.getRandomValues(new Uint8Array(12)),{encryptedData:o}=await R(n,a,s.buffer),c=new Uint8Array(e.length+s.length+o.byteLength);return c.set(e,0),c.set(s,e.length),c.set(new Uint8Array(o),e.length+s.length),{encryptedData:_(c)}}catch(e){throw console.error("Password encryption failed:",e),new Error("Failed to encrypt with password")}}async decryptWithPassword(t,r){try{const e=M(t),a=new Uint8Array(e),n=a.slice(0,16),s=a.slice(16,28),o=a.slice(28),c=await $(r,n),d=await O(o.buffer,c,s.buffer);return H(d)}catch(e){throw console.error("Password decryption failed:",e),new Error("Failed to decrypt with password")}}async generateKey(t,r,e){const n=await Fe(t==="STANDARD"?"standard":t==="E2EE"?"high":"ultra");try{const s=JSON.parse(n);s.encryptionType=r,e&&(s.length=e);const o=JSON.stringify(s),c=this.generateKeyId();return{key:o,keyId:c}}catch{const o=this.generateKeyId();return{key:n,keyId:o}}}generateKeyId(){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`key_${t}_${r}`}async verifyKey(t,r){try{return await this.decrypt(t,r),!0}catch{return!1}}generateRandomString(t=32){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_!@#$%^&*()";let e="";const a=new Uint8Array(t);window.crypto.getRandomValues(a);for(let n=0;n<t;n++)e+=r.charAt(a[n]%r.length);return e}async reEncrypt(t,r,e,a,n){try{const s=await this.decrypt(t,r);let o={};try{const d=JSON.parse(s);d&&typeof d=="object"&&d.metadata&&(o=d.metadata)}catch{console.debug("Could not extract metadata from decrypted data")}const c={...o,keyRotation:{timestamp:Date.now(),fromSecurityLevel:this.getSecurityLevelFromKey(r),toSecurityLevel:e||"E2EE"}};return this.encrypt(s,e||"E2EE",a||"MESSAGE",n,c)}catch(s){throw console.error("Re-encryption failed:",s),new Error(`Failed to re-encrypt data: ${s instanceof Error?s.message:"Unknown error"}`)}}getSecurityLevelFromKey(t){try{const r=JSON.parse(t);return r.length>=256?"P2P_E2EE":r.length>=192?"E2EE":"STANDARD"}catch{return"STANDARD"}}async deriveKeyFromPassphrase(t,r){try{const e=r||z(16),a=J(e),n=await $(t,a,1e5,[h.ENCRYPT,h.DECRYPT],!0),s=await j(n),o=this.generateKeyId();return A.set(o,n),{key:JSON.stringify({id:o,jwk:s,algorithm:w.AES_GCM,length:256,derivedFromPassphrase:!0,salt:e,timestamp:Date.now()}),salt:e,keyObject:n}}catch(e){throw console.error("Key derivation failed:",e),new Error(`Failed to derive key from passphrase: ${e instanceof Error?e.message:"Unknown error"}`)}}async rotateKeys(){const t=new Map,r=Date.now()-this.keyRotationPolicy.intervalDays*24*60*60*1e3;let e=0;const a=new Map;for(const[n,s]of this.keyHistory.entries())s.createdAt<r&&a.set(n,s);for(const[n,{key:s}]of a.entries())try{const o=JSON.parse(s),c=this.getSecurityLevelFromKey(s);let d;o.encryptionType?d=o.encryptionType:o.algorithm===w.AES_GCM?o.derivedFromPassphrase?d="USER_DATA":o.length>=256?d="FILE":d="MESSAGE":d="MESSAGE";const{key:y,keyId:u}=await this.generateKey(c,d,o.length||void 0);t.set(`${c}_${d}_${n}`,{key:y,keyId:u}),this.keyHistory.set(u,{key:y,createdAt:Date.now()});const p=`${u}_rotation_info`;this.keyHistory.set(p,{key:JSON.stringify({rotatedFrom:n,rotatedAt:Date.now(),previousKeyCreatedAt:o.timestamp||0,securityLevel:c,encryptionType:d}),createdAt:Date.now()}),e++,console.info(`Key rotated: ${n} â†’ ${u} (${d}, ${c})`)}catch(o){console.error(`Failed to rotate key ${n}:`,o)}return this.keyHistory.size>this.keyRotationPolicy.retainPreviousKeys*2&&this.pruneOldKeys(),console.info(`Key rotation completed. ${e} keys rotated.`),t}pruneOldKeys(){const t=Array.from(this.keyHistory.entries()).filter(([e])=>!e.includes("_rotation_info")).sort(([,e],[,a])=>e.createdAt-a.createdAt),r=Math.max(0,t.length-this.keyRotationPolicy.retainPreviousKeys);if(r>0){for(let e=0;e<r;e++){const[a]=t[e];this.keyHistory.delete(a),this.keyHistory.delete(`${a}_rotation_info`)}console.info(`Pruned ${r} old keys from history.`)}}setKeyRotationPolicy(t){this.keyRotationPolicy={...this.keyRotationPolicy,...t}}getKeyRotationPolicy(){return{...this.keyRotationPolicy}}getKeyById(t){const r=this.keyHistory.get(t);return r==null?void 0:r.key}async integrateWithOfflineEncryption(t,r){try{const{encryptPageForOffline:e}=await B(async()=>{const{encryptPageForOffline:a}=await import("./offlinePageEncryption-Bbo2BKkO.js");return{encryptPageForOffline:a}},__vite__mapDeps([0,1,2]));this.isOnCustomDomain()&&(await e(t,{content:JSON.stringify(r),metadata:{timestamp:Date.now(),domain:window.location.hostname,version:"2.0"}}),console.debug(`Page ${t} encrypted for offline use on custom domain`))}catch(e){console.error("Failed to integrate with offline encryption:",e)}}async decryptOfflinePage(t,r){try{const{decryptOfflinePage:e}=await B(async()=>{const{decryptOfflinePage:a}=await import("./offlinePageEncryption-Bbo2BKkO.js");return{decryptOfflinePage:a}},__vite__mapDeps([0,1,2]));return await e(t,r)}catch(e){throw console.error("Failed to decrypt offline page:",e),new Error(`Offline page decryption failed: ${e.message}`)}}getDomainSecurityInfo(){const t=this.isOnCustomDomain(),r=window.location.hostname;return{isCustomDomain:t,domain:r,recommendedSecurityLevel:t?"P2P_E2EE":"E2EE",isOfflineCapable:t}}};new ee;var b=(l=>(l.STANDARD="standard",l.ENHANCED="enhanced",l.PREMIUM="premium",l))(b||{});const ne={name:"New Group",securityLevel:"enhanced",allowMediaSharing:!0,allowLinkPreviews:!0,allowMemberInvites:!1,allowScreenshots:!0,messageRetentionDays:30,isPrivate:!0,maxMembers:50,requireEncryption:!0};class ye{constructor(){S(this,"encryptionService");this.encryptionService=new ee}async createGroup(t,r,e){const a={...ne,...e,name:t},n=this.generateGroupId(),s={id:r.id,role:"admin",joinedAt:new Date,displayName:r.displayName,publicKey:r.publicKey},o={id:n,settings:a,createdAt:new Date,createdBy:r.id,members:[s]};if(a.requireEncryption||a.securityLevel==="enhanced"||a.securityLevel==="premium"){const{keyId:c}=await this.generateGroupEncryptionKey(o);o.encryptionKeys={groupKeyId:c,rotatedAt:new Date,keyVersion:1}}return await this.saveGroup(o),o}async addGroupMember(t,r,e="member",a){const n=await this.getGroup(t),s=n.members.find(d=>d.id===a);if(!s||s.role!=="admin"&&s.role!=="moderator")throw new Error("You do not have permission to add members to this group");if(n.members.some(d=>d.id===r))throw new Error("User is already a member of this group");if(n.members.length>=n.settings.maxMembers)throw new Error(`Group has reached maximum capacity of ${n.settings.maxMembers} members`);const o=await this.getUserInfo(r),c={id:r,role:e,joinedAt:new Date,displayName:o.displayName,publicKey:o.publicKey};return n.members.push(c),await this.saveGroup(n),n.encryptionKeys&&await this.shareGroupKeyWithMember(n,c),c}async sendGroupMessage(t,r,e,a){const n=await this.getGroup(t),s=n.members.find(d=>d.id===r);if(!s)throw new Error("You are not a member of this group");const c={id:this.generateMessageId(),sender:{id:r,displayName:s.displayName},content:e,timestamp:new Date};if(n.encryptionKeys){const d=await this.encryptGroupMessage(e,n);c.content=d.encryptedData,c.encryptionInfo={isEncrypted:!0,keyId:d.keyId,algorithm:"AES-GCM"}}return a&&a.length>0&&n.settings.allowMediaSharing&&(c.mediaAttachments=await Promise.all(a.map(async d=>{const y=await this.uploadGroupMedia(d.file,n);return{url:y.url,type:d.type,name:d.file.name,thumbnailUrl:y.thumbnailUrl,encryptionInfo:y.encrypted?{isEncrypted:!0,keyId:y.keyId||""}:void 0}}))),await this.saveGroupMessage(t,c),c}async getGroupMessages(t,r,e=50,a){if(!(await this.getGroup(t)).members.some(o=>o.id===r))throw new Error("You are not a member of this group");const s=await this.fetchGroupMessages(t,e,a);return await this.markMessagesAsDelivered(t,s.map(o=>o.id),r),s}async markMessageAsRead(t,r,e){const a=await this.getGroupMessage(t,r);a.readBy&&a.readBy.includes(e)||(a.readBy||(a.readBy=[]),a.readBy.push(e),await this.saveGroupMessage(t,a))}async addReaction(t,r,e,a){const n=await this.getGroupMessage(t,r);n.reactions||(n.reactions=[]);const s=n.reactions.find(o=>o.emoji===a);s?s.userIds.includes(e)||(s.userIds.push(e),s.count++):n.reactions.push({emoji:a,count:1,userIds:[e]}),await this.saveGroupMessage(t,n)}async deleteMessage(t,r,e){const a=await this.getGroupMessage(t,r),s=(await this.getGroup(t)).members.find(o=>o.id===e);if(!s)throw new Error("You are not a member of this group");if(a.sender.id!==e&&s.role!=="admin"&&s.role!=="moderator")throw new Error("You do not have permission to delete this message");a.isDeleted=!0,a.content="[Message deleted]",delete a.mediaAttachments,await this.saveGroupMessage(t,a)}async editMessage(t,r,e,a){var c;const n=await this.getGroupMessage(t,r),s=await this.getGroup(t);if(n.sender.id!==e)throw new Error("You can only edit your own messages");if(n.isDeleted)throw new Error("Cannot edit a deleted message");const o=n.content;if(s.encryptionKeys&&((c=n.encryptionInfo)!=null&&c.isEncrypted)){const d=await this.encryptGroupMessage(a,s,n.encryptionInfo.keyId);n.content=d.encryptedData}else n.content=a;return n.isEdited=!0,n.editHistory=n.editHistory||[],n.editHistory.push({timestamp:new Date,editorId:e,previousContent:o}),await this.saveGroupMessage(t,n),n}async leaveGroup(t,r){const e=await this.getGroup(t),a=e.members.findIndex(s=>s.id===r);if(a===-1)throw new Error("You are not a member of this group");if(e.members[a].role==="admin"&&e.members.filter(s=>s.role==="admin").length===1){const s=e.members.find(o=>o.role==="moderator"&&o.id!==r);if(s)s.role="admin";else{const o=e.members.find(c=>c.id!==r);if(o)o.role="admin";else{await this.deleteGroup(t);return}}}e.members.splice(a,1),await this.saveGroup(e),e.encryptionKeys&&e.settings.securityLevel==="premium"&&await this.rotateGroupKeyInternal(e)}async updateGroupSettings(t,r,e){const a=await this.getGroup(t),n=a.members.find(s=>s.id===r);if(!n||n.role!=="admin")throw new Error("You do not have permission to update group settings");if(a.settings={...a.settings,...e},e.securityLevel&&e.securityLevel!==a.settings.securityLevel)if(e.securityLevel==="standard")delete a.encryptionKeys;else if(a.encryptionKeys)e.securityLevel==="premium"&&await this.rotateGroupKey(a.id,a.createdBy);else{const{keyId:s}=await this.generateGroupEncryptionKey(a);a.encryptionKeys={groupKeyId:s,rotatedAt:new Date,keyVersion:1}}return await this.saveGroup(a),a}async rotateGroupKey(t,r){const e=await this.getGroup(t),a=e.members.find(n=>n.id===r);if(!a||a.role!=="admin")throw new Error("Only group admins can rotate encryption keys");if(!e.encryptionKeys)return{success:!1};try{const{keyId:n}=await this.generateGroupEncryptionKey(e),s=(e.encryptionKeys.keyVersion||1)+1;return e.encryptionKeys={groupKeyId:n,rotatedAt:new Date,keyVersion:s},await this.saveGroup(e),await Promise.all(e.members.map(async o=>{await this.shareGroupKeyWithMember(e,o)})),console.log(`Group ${t} encryption key rotated. New key ID: ${n}, version: ${s}`),{success:!0,newKeyId:n,keyVersion:s}}catch(n){throw console.error(`Failed to rotate key for group ${t}:`,n),new Error(`Key rotation failed: ${n instanceof Error?n.message:"Unknown error"}`)}}async reEncryptGroupHistory(t,r,e,a){var o;const n=await this.getGroup(t),s=n.members.find(c=>c.id===a);if(!s||s.role!=="admin")throw new Error("Only group admins can re-encrypt messages");try{const c=await this.fetchGroupEncryptedMessages(t,r);let d=0;for(const y of c)if((o=y.encryptionInfo)!=null&&o.isEncrypted&&y.encryptionInfo.keyId===r){const u=await this.decryptGroupMessage(y.content,r),p=await this.encryptGroupMessage(u,n,e);y.content=p.encryptedData,y.encryptionInfo.keyId=e,await this.saveGroupMessage(t,y),d++}return console.log(`Re-encrypted ${d} messages in group ${t}`),{success:!0,messagesReEncrypted:d}}catch(c){throw console.error(`Failed to re-encrypt messages for group ${t}:`,c),new Error(`Re-encryption failed: ${c instanceof Error?c.message:"Unknown error"}`)}}generateGroupId(){return`grp_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,9)}`}generateMessageId(){return`msg_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,9)}`}async generateGroupEncryptionKey(t){var c;const r=t.createdBy||((c=t.members.find(d=>d.role==="admin"))==null?void 0:c.id)||"";if(!r)throw new Error("Group must have a creator or admin to generate encryption keys");const e=t.settings.securityLevel==="premium"?"ultra":t.settings.securityLevel==="enhanced"?"high":"standard",{key:a,groupKey:n}=await Ee(t.id,r,e),s=await j(a);return{key:JSON.stringify(s),keyId:n.keyId}}async encryptGroupMessage(t,r,e){if(!r.encryptionKeys)throw new Error("Group does not have encryption enabled");const a=e||r.encryptionKeys.groupKeyId;try{const n=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),{encryptedData:s,iv:o}=await be(t,n);return{encryptedData:`${s}|${o}`,keyId:a}}catch(n){console.error("Error encrypting group message:",n);const s=await this.encryptionService.encrypt(t,C.E2EE,le.MESSAGE);return{encryptedData:s.encryptedData,keyId:e||s.keyId}}}async decryptGroupMessage(t,r){try{const[e,a]=t.split("|");if(!e||!a)throw new Error("Invalid encrypted message format");const n=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return await ke(e,a,n)}catch(e){return console.error("Error decrypting group message:",e),this.encryptionService.decrypt(t,r)}}async uploadGroupMedia(t,r){const e=r.settings.securityLevel!=="standard",a=`${Date.now()}_${t.name.replace(/[^a-z0-9.]/gi,"_")}`;let n;return e&&(n=`fk_${r.id}_${Date.now().toString(36)}`),{url:`https://storage.snakkaz.com/group-media/${r.id}/${a}`,thumbnailUrl:t.type.startsWith("image/")?`https://storage.snakkaz.com/group-media/${r.id}/thumbnails/${a}`:void 0,encrypted:e,keyId:n}}async shareGroupKeyWithMember(t,r){console.log(`Sharing group key for ${t.id} with member ${r.id}`)}async rotateGroupKeyInternal(t){if(!t.encryptionKeys)throw new Error("Group doesn't have encryption enabled");const{keyId:r}=await this.generateGroupEncryptionKey(t),e=(t.encryptionKeys.keyVersion||0)+1;return t.encryptionKeys={groupKeyId:r,rotatedAt:new Date,keyVersion:e},await this.saveGroup(t),await Promise.all(t.members.map(async a=>{await this.shareGroupKeyWithMember(t,a)})),console.log(`Rotated encryption key for group ${t.id}`),{keyId:r,keyVersion:e}}async fetchGroupEncryptedMessages(t,r){return[]}async markMessagesAsDelivered(t,r,e){console.log(`Marking ${r.length} messages as delivered to ${e} in group ${t}`)}async getGroup(t){return{id:t,settings:{...ne,name:"Test Group"},createdAt:new Date,createdBy:"user123",members:[{id:"user123",role:"admin",joinedAt:new Date}]}}async saveGroup(t){console.log(`Saving group: ${JSON.stringify(t)}`)}async getUserInfo(t){return{id:t,displayName:`User ${t.substring(0,4)}`,publicKey:`pk_${t}_${Date.now()}`}}async deleteGroup(t){console.log(`Deleting group ${t}`)}async saveGroupMessage(t,r){console.log(`Saving message to group ${t}: ${JSON.stringify(r)}`)}async getGroupMessage(t,r){return{id:r,sender:{id:"user123",displayName:"Test User"},content:"Test message",timestamp:new Date}}async fetchGroupMessages(t,r,e){return[{id:`msg_${Date.now()-1e3}`,sender:{id:"user123",displayName:"Test User"},content:"Test message 1",timestamp:new Date(Date.now()-1e3)},{id:`msg_${Date.now()-2e3}`,sender:{id:"user456",displayName:"Another User"},content:"Test message 2",timestamp:new Date(Date.now()-2e3)}]}}new ye;const Je={maxSizeMB:10,compressImages:!0,encryptMedia:!0,securityLevel:C.E2EE,generateThumbnail:!0,allowedTypes:["image","video","document","audio"]};class I extends Error{constructor(r,e){super(r);S(this,"type");this.type=e,this.name="MediaUploadError"}}class me{constructor(t){S(this,"encryptionService");S(this,"options");this.options={...Je,...t},this.encryptionService=new ee}getMediaType(t){switch(t.type.split("/")[0]){case"image":return"image";case"video":return"video";case"audio":return"audio";default:return"document"}}async compressImage(t){try{const r=await this.getImageDimensions(t);return{file:t,dimensions:r}}catch(r){throw new I(`Image compression failed: ${r instanceof Error?r.message:"Unknown error"}`,"compression_failed")}}async getImageDimensions(t){return new Promise((r,e)=>{const a=new Image;a.onload=()=>{r({width:a.width,height:a.height}),URL.revokeObjectURL(a.src)},a.onerror=()=>{e(new Error("Failed to load image")),URL.revokeObjectURL(a.src)},a.src=URL.createObjectURL(t)})}async generateThumbnail(t,r=!1){try{return"https://via.placeholder.com/200x200"}catch(e){return console.warn("Failed to generate thumbnail:",e),""}}async uploadMedia(t,r){const e={...this.options,...r};try{if(t.size>(e.maxSizeMB||10)*1024*1024)throw new I(`File too large (${(t.size/(1024*1024)).toFixed(2)}MB). Maximum size is ${e.maxSizeMB}MB.`,"file_too_large");const a=this.getMediaType(t);if(e.allowedTypes&&!e.allowedTypes.includes(a))throw new I(`Unsupported media type: ${a}`,"unsupported_type");let n=t,s;if(a==="image"&&e.compressImages){const E=await this.compressImage(t);n=E.file,s=E.dimensions}const o=t.name.split(".").pop()||"",c=`${Date.now()}_${Math.random().toString(36).substring(2)}.${o}`;let d,y,u=!1,p,x;if(e.encryptMedia){const E=await this.encryptFile(n,e.securityLevel||C.E2EE);d=await this.uploadToStorage(E.file),p=E.keyId,u=!0}else d=await this.uploadToStorage(n);return e.generateThumbnail&&a==="image"&&(y=await this.generateThumbnail(n,u)),{originalFile:t,url:d,thumbnailUrl:y,type:a,size:n.size,dimensions:s,encrypted:u,keyId:p,encryptionDetails:x}}catch(a){throw a instanceof I?a:(console.error("Media upload failed:",a),new I(`Media upload failed: ${a instanceof Error?a.message:"Unknown error"}`,"upload_failed"))}}async readFileAsArrayBuffer(t){return new Promise((r,e)=>{const a=new FileReader;a.onload=()=>{a.result instanceof ArrayBuffer?r(a.result):e(new Error("Failed to read file as ArrayBuffer"))},a.onerror=()=>{e(new Error("File read error"))},a.readAsArrayBuffer(t)})}readBlobAsArrayBuffer(t){return new Promise((r,e)=>{const a=new FileReader;a.onload=()=>{a.result instanceof ArrayBuffer?r(a.result):e(new Error("Failed to read blob as ArrayBuffer"))},a.onerror=()=>{e(new Error("Blob read error"))},a.readAsArrayBuffer(t)})}async encryptFile(t,r){try{const e=r===C.STANDARD?128:256,a=await Q(e,!0),n=await j(a),s=`file_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,o=await this.readFileAsArrayBuffer(t),{encryptedData:c,iv:d}=await R(o,a);await this.storeEncryptionKey(s,n,{fileName:t.name,fileType:t.type,fileSize:t.size,iv:_(d),securityLevel:r,timestamp:Date.now()});const y=new Blob([c],{type:"application/octet-stream"});return{file:new File([y],`${s}_${t.name}.enc`,{type:"application/octet-stream",lastModified:Date.now()}),keyId:s}}catch(e){throw console.error("File encryption failed:",e),new I(`Encryption failed: ${e instanceof Error?e.message:"Unknown error"}`,"encryption_failed")}}async uploadToStorage(t){try{const r=`${Date.now()}_${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,e=t.type==="application/octet-stream"?"encrypted-media":"media",{data:a,error:n}=await D.storage.from(e).upload(r,t,{cacheControl:"3600",upsert:!1,contentType:t.type});if(n)throw new Error(`Storage upload failed: ${n.message}`);const{data:s}=D.storage.from(e).getPublicUrl(r);return s.publicUrl}catch(r){throw console.error("File upload failed:",r),new I(`Upload failed: ${r instanceof Error?r.message:"Unknown error"}`,"upload_failed")}}async storeEncryptionKey(t,r,e){try{const{error:a}=await D.from("encryption_keys").insert({key_id:t,key_type:"FILE",key_jwk:JSON.stringify(r),created_at:new Date().toISOString(),metadata:e});if(a)throw console.error("Failed to store encryption key:",a),a}catch(a){console.error("Key storage failed:",a)}}async decryptFile(t,r){try{const{data:e,error:a}=await D.from("encryption_keys").select("*").eq("key_id",r).single();if(a||!e)throw new Error(`Encryption key not found: ${(a==null?void 0:a.message)||"Key not available"}`);const n=JSON.parse(e.key_jwk),s=await T(n,w.AES_GCM,[h.DECRYPT]),o=M(e.metadata.iv);let c;t instanceof File?c=await this.readFileAsArrayBuffer(t):t instanceof Blob?c=await this.readBlobAsArrayBuffer(t):c=t;const d=await O(c,s,o);return new Blob([d],{type:e.metadata.fileType||"application/octet-stream"})}catch(e){throw console.error("File decryption failed:",e),new Error(`Failed to decrypt file: ${e instanceof Error?e.message:"Unknown error"}`)}}}new me;const N=new Map,He=async(l,t)=>{const r=l==="standard"?128:256,e=await Q(r,!0),a=await j(e),n=z(16);return N.set(n,e),JSON.stringify({id:n,jwk:a,algorithm:w.AES_GCM,length:r,timestamp:Date.now()})},ze=async(l,t,r)=>{try{const e=JSON.parse(t);let a;N.has(e.id)?a=N.get(e.id):(a=await T(e.jwk,w.AES_GCM,[h.ENCRYPT,h.DECRYPT],!0),N.set(e.id,a));const{encryptedData:n,iv:s}=await R(l,a);return JSON.stringify({ciphertext:_(n),iv:_(s),keyId:e.id,algorithm:w.AES_GCM,type:r})}catch(e){throw console.error("Encryption failed:",e),new Error(`Encryption failed: ${e instanceof Error?e.message:"Unknown error"}`)}},Ye=async(l,t)=>{try{const r=JSON.parse(l),e=JSON.parse(t);let a;if(N.has(e.id)?a=N.get(e.id):(a=await T(e.jwk,w.AES_GCM,[h.ENCRYPT,h.DECRYPT],!0),N.set(e.id,a)),r.keyId&&r.keyId!==e.id)throw new Error("Key ID mismatch");const n=M(r.ciphertext),s=M(r.iv),o=await O(n,a,s);return H(o)}catch(r){throw console.error("Decryption failed:",r),new Error(`Decryption failed: ${r instanceof Error?r.message:"Unknown error"}`)}},Ve={intervalDays:30,autoRotate:!0,retainPreviousKeys:3};class ue{constructor(t={}){S(this,"keyRotationPolicy");S(this,"keyHistory",new Map);this.keyRotationPolicy={...Ve,...t}}isOnCustomDomain(){var e,a;const t=window.location.hostname,r=((a=(e=oe)==null?void 0:e.supabase)==null?void 0:a.customDomain)||"www.snakkaz.com";return t===r||t===r.replace("www.","")}getRecommendedSecurityLevel(t){if(this.isOnCustomDomain())switch(t){case"MESSAGE":case"USER_DATA":return"E2EE";case"FILE":case"WHOLE_PAGE":return"P2P_E2EE";default:return"E2EE"}switch(t){case"MESSAGE":return"E2EE";case"USER_DATA":return"STANDARD";case"FILE":case"WHOLE_PAGE":return"E2EE";default:return"STANDARD"}}async encrypt(t,r="E2EE",e="MESSAGE",a,n){try{const s=typeof t=="object"?JSON.stringify(t):t,{key:o,keyId:c}=a?{key:a,keyId:this.generateKeyId()}:await this.generateKey(r,e);return a||this.keyHistory.set(c,{key:o,createdAt:Date.now()}),{encryptedData:await ze(s,o,e),keyId:c,securityLevel:r,timestamp:Date.now(),metadata:{encryptionType:e,version:"1.2",...n}}}catch(s){throw console.error("Encryption failed:",s),new Error(`Failed to encrypt data: ${s.message}`)}}async decrypt(t,r,e){try{const a=await Ye(t,r);try{return JSON.parse(a)}catch{return console.debug("JSON parsing failed during decryption, returning raw data"),a}}catch(a){throw console.error("Decryption failed:",a),new Error(`Failed to decrypt data: ${a.message}`)}}async encryptWithPassword(t,r){try{const e=ie(),a=await $(r,e),n=J(t),s=window.crypto.getRandomValues(new Uint8Array(12)),{encryptedData:o}=await R(n,a,s.buffer),c=new Uint8Array(e.length+s.length+o.byteLength);return c.set(e,0),c.set(s,e.length),c.set(new Uint8Array(o),e.length+s.length),{encryptedData:_(c)}}catch(e){throw console.error("Password encryption failed:",e),new Error("Failed to encrypt with password")}}async decryptWithPassword(t,r){try{const e=M(t),a=new Uint8Array(e),n=a.slice(0,16),s=a.slice(16,28),o=a.slice(28),c=await $(r,n),d=await O(o.buffer,c,s.buffer);return H(d)}catch(e){throw console.error("Password decryption failed:",e),new Error("Failed to decrypt with password")}}async generateKey(t,r,e){const n=await He(t==="STANDARD"?"standard":t==="E2EE"?"high":"ultra");try{const s=JSON.parse(n);s.encryptionType=r,e&&(s.length=e);const o=JSON.stringify(s),c=this.generateKeyId();return{key:o,keyId:c}}catch{const o=this.generateKeyId();return{key:n,keyId:o}}}generateKeyId(){const t=Date.now().toString(36),r=Math.random().toString(36).substring(2,10);return`key_${t}_${r}`}async verifyKey(t,r){try{return await this.decrypt(t,r),!0}catch{return!1}}generateRandomString(t=32){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_!@#$%^&*()";let e="";const a=new Uint8Array(t);window.crypto.getRandomValues(a);for(let n=0;n<t;n++)e+=r.charAt(a[n]%r.length);return e}async reEncrypt(t,r,e,a,n){try{const s=await this.decrypt(t,r);let o={};try{const d=JSON.parse(s);d&&typeof d=="object"&&d.metadata&&(o=d.metadata)}catch{console.debug("Could not extract metadata from decrypted data")}const c={...o,keyRotation:{timestamp:Date.now(),fromSecurityLevel:this.getSecurityLevelFromKey(r),toSecurityLevel:e||"E2EE"}};return this.encrypt(s,e||"E2EE",a||"MESSAGE",n,c)}catch(s){throw console.error("Re-encryption failed:",s),new Error(`Failed to re-encrypt data: ${s instanceof Error?s.message:"Unknown error"}`)}}getSecurityLevelFromKey(t){try{const r=JSON.parse(t);return r.length>=256?"P2P_E2EE":r.length>=192?"E2EE":"STANDARD"}catch{return"STANDARD"}}async deriveKeyFromPassphrase(t,r){try{const e=r||z(16),a=J(e),n=await $(t,a,1e5,[h.ENCRYPT,h.DECRYPT],!0),s=await j(n),o=this.generateKeyId();return N.set(o,n),{key:JSON.stringify({id:o,jwk:s,algorithm:w.AES_GCM,length:256,derivedFromPassphrase:!0,salt:e,timestamp:Date.now()}),salt:e,keyObject:n}}catch(e){throw console.error("Key derivation failed:",e),new Error(`Failed to derive key from passphrase: ${e instanceof Error?e.message:"Unknown error"}`)}}async rotateKeys(){const t=new Map,r=Date.now()-this.keyRotationPolicy.intervalDays*24*60*60*1e3;let e=0;const a=new Map;for(const[n,s]of this.keyHistory.entries())s.createdAt<r&&a.set(n,s);for(const[n,{key:s}]of a.entries())try{const o=JSON.parse(s),c=this.getSecurityLevelFromKey(s);let d;o.encryptionType?d=o.encryptionType:o.algorithm===w.AES_GCM?o.derivedFromPassphrase?d="USER_DATA":o.length>=256?d="FILE":d="MESSAGE":d="MESSAGE";const{key:y,keyId:u}=await this.generateKey(c,d,o.length||void 0);t.set(`${c}_${d}_${n}`,{key:y,keyId:u}),this.keyHistory.set(u,{key:y,createdAt:Date.now()});const p=`${u}_rotation_info`;this.keyHistory.set(p,{key:JSON.stringify({rotatedFrom:n,rotatedAt:Date.now(),previousKeyCreatedAt:o.timestamp||0,securityLevel:c,encryptionType:d}),createdAt:Date.now()}),e++,console.info(`Key rotated: ${n} â†’ ${u} (${d}, ${c})`)}catch(o){console.error(`Failed to rotate key ${n}:`,o)}return this.keyHistory.size>this.keyRotationPolicy.retainPreviousKeys*2&&this.pruneOldKeys(),console.info(`Key rotation completed. ${e} keys rotated.`),t}pruneOldKeys(){const t=Array.from(this.keyHistory.entries()).filter(([e])=>!e.includes("_rotation_info")).sort(([,e],[,a])=>e.createdAt-a.createdAt),r=Math.max(0,t.length-this.keyRotationPolicy.retainPreviousKeys);if(r>0){for(let e=0;e<r;e++){const[a]=t[e];this.keyHistory.delete(a),this.keyHistory.delete(`${a}_rotation_info`)}console.info(`Pruned ${r} old keys from history.`)}}setKeyRotationPolicy(t){this.keyRotationPolicy={...this.keyRotationPolicy,...t}}getKeyRotationPolicy(){return{...this.keyRotationPolicy}}getKeyById(t){const r=this.keyHistory.get(t);return r==null?void 0:r.key}async integrateWithOfflineEncryption(t,r){try{const{encryptPageForOffline:e}=await B(async()=>{const{encryptPageForOffline:a}=await import("./offlinePageEncryption-Bbo2BKkO.js");return{encryptPageForOffline:a}},__vite__mapDeps([0,1,2]));this.isOnCustomDomain()&&(await e(t,{content:JSON.stringify(r),metadata:{timestamp:Date.now(),domain:window.location.hostname,version:"2.0"}}),console.debug(`Page ${t} encrypted for offline use on custom domain`))}catch(e){console.error("Failed to integrate with offline encryption:",e)}}async decryptOfflinePage(t,r){try{const{decryptOfflinePage:e}=await B(async()=>{const{decryptOfflinePage:a}=await import("./offlinePageEncryption-Bbo2BKkO.js");return{decryptOfflinePage:a}},__vite__mapDeps([0,1,2]));return await e(t,r)}catch(e){throw console.error("Failed to decrypt offline page:",e),new Error(`Offline page decryption failed: ${e.message}`)}}getDomainSecurityInfo(){const t=this.isOnCustomDomain(),r=window.location.hostname;return{isCustomDomain:t,domain:r,recommendedSecurityLevel:t?"P2P_E2EE":"E2EE",isOfflineCapable:t}}}new ue;new ye;new me;new ue;const We=f.createContext(void 0),qe=()=>{const l=f.useContext(We);if(l===void 0)throw new Error("useChat must be used within a ChatProvider");return l},P={buttonGlow:`
    @keyframes buttonGlow {
      0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.2); }
      50% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5), 0 0 15px rgba(255, 215, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.1); }
      100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.2); }
    }
  `,shineEffect:`
    @keyframes shineEffect {
      from { 
        background-position: -100% 0; 
      }
      to { 
        background-position: 200% 0; 
      }
    }
  `,pulse:`
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  `,fadeSlideIn:`
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  `,secureIconSpin:`
    @keyframes secureIconSpin {
      0% { transform: rotate(0deg); opacity: 0.7; }
      50% { transform: rotate(180deg); opacity: 1; }
      100% { transform: rotate(360deg); opacity: 0.7; }
    }
  `},Ze=({onLoginSuccess:l,onLoginError:t,variant:r="default",size:e="md",showIcon:a=!0,fullWidth:n=!1,className:s="",authMethod:o="google",loginText:c="Sign In",loadingText:d="Logging in...",errorText:y="Try Again",secure:u=!0,e2ee:p=!0})=>{const[x,E]=f.useState(!1),[v,F]=f.useState(null),[L,Y]=f.useState(!1),[U,m]=f.useState(!1);f.useEffect(()=>{(async()=>{const k=window.location.protocol==="https:";Y(k),m(!0)})()},[]);const K=async()=>{E(!0),F(null);try{!L&&u&&console.warn("Warning: Login attempted on non-secure connection");let g;switch(o){case"google":g=await D.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});break;case"microsoft":g=await D.auth.signInWithOAuth({provider:"azure",options:{redirectTo:window.location.origin}});break;case"magic-link":console.log("Magic link authentication not yet implemented");break;case"email":console.log("Email authentication requires additional inputs");break;default:g=await D.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}})}if(g!=null&&g.error)throw g.error;l&&l()}catch(g){const k=g instanceof Error?g:new Error("Unknown error during login");F(k.message),t&&t(k)}finally{E(!1)}},G={sm:"py-1.5 px-3 text-sm",md:"py-2 px-4 text-base",lg:"py-2.5 px-6 text-lg"}[e],pe={default:`
      bg-gradient-to-r from-cybergold-700 to-cybergold-500 
      hover:from-cybergold-600 hover:to-cybergold-400
      text-cyberdark-900 
      border border-cybergold-500
      shadow-lg shadow-cybergold-900/20
      hover:shadow-cybergold-900/30
      hover:scale-[1.02]
      active:scale-[0.98]
      transition-all duration-300
      after:content-['']
      after:absolute
      after:inset-0
      after:bg-gradient-to-r
      after:from-transparent
      after:via-cybergold-300/30
      after:to-transparent
      after:opacity-0
      hover:after:opacity-100
      after:transition-opacity
      after:duration-1000
      after:animate-[shineEffect_3s_ease-in-out_infinite]
      animate-[buttonGlow_3s_ease-in-out_infinite]
    `,outline:`
      bg-transparent
      text-cybergold-500
      border-2 border-cybergold-500/50
      hover:bg-cybergold-900/30
      hover:border-cybergold-500
      hover:text-cybergold-400
      shadow-none
      hover:shadow-inner
      hover:shadow-cybergold-900/10
      transition-all duration-300
    `,ghost:`
      bg-transparent 
      text-cybergold-500
      hover:bg-cybergold-900/20
      hover:text-cybergold-400
      border-none
      shadow-none
      transition-all duration-300
    `,secure:`
      bg-cyberdark-900
      text-cybergold-500
      border border-cybergold-500
      hover:bg-cyberdark-800
      hover:text-cybergold-400
      shadow-lg shadow-cybergold-900/20
      hover:shadow-cybergold-900/30
      transition-all duration-300
      animate-[secureIconSpin_2s_linear_infinite]
    `}[r],ge=`
    relative
    font-medium
    rounded-md
    overflow-hidden
    flex items-center justify-center
    ${G}
    ${pe}
    ${n?"w-full":""}
    ${s}
    ${x?"opacity-80 cursor-wait":"cursor-pointer"}
    ${v?"animate-[pulse_2s_ease-in-out]":""}
    focus:outline-none focus:ring-2 focus:ring-cybergold-500/50 focus:ring-offset-2 focus:ring-offset-cyberdark-900
  `;f.useEffect(()=>{const g="snakkaz-login-animations";if(typeof document<"u"&&!document.getElementById(g)){const k=document.createElement("style");k.id=g,k.textContent=`
        ${P.buttonGlow}
        ${P.shineEffect}
        ${P.pulse}
        ${P.fadeSlideIn}
        ${P.secureIconSpin}
      `,document.head.appendChild(k)}return()=>{var k;if(typeof document<"u"){const V=document.getElementById(g);V&&((k=V.parentNode)==null||k.removeChild(V))}}},[]);const fe=()=>U?i.jsx("div",{className:"absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",children:L?i.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 flex items-center justify-center",children:i.jsx(Ge,{size:12,className:"text-cyberdark-900"})}):i.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 flex items-center justify-center",children:i.jsx(ae,{size:12,className:"text-cyberdark-900"})})}):null;return i.jsxs(i.Fragment,{children:[i.jsxs("button",{className:ge,onClick:K,disabled:x,title:`Sign in to Snakkaz Chat${p?" (End-to-End Encrypted)":""}`,children:[i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a&&(x?i.jsx(ce,{size:e==="sm"?14:e==="lg"?20:16,className:"animate-spin"}):v?i.jsx(ae,{size:e==="sm"?14:e==="lg"?20:16,className:"text-red-500"}):u?i.jsx(je,{size:e==="sm"?14:e==="lg"?20:16,className:"animate-pulse"}):i.jsx(de,{size:e==="sm"?14:e==="lg"?20:16})),i.jsx("span",{children:x?d:v?y:c}),!x&&!v&&a&&i.jsx(Ke,{size:e==="sm"?14:e==="lg"?20:16,className:"ml-1"})]}),u&&i.jsx(fe,{})]}),v&&i.jsx("div",{className:"text-xs text-red-500 mt-1 animate-[fadeSlideIn_0.3s_ease-in-out]",children:v}),p&&!v&&i.jsxs("div",{className:"text-xs text-cybergold-500/70 mt-1 flex items-center gap-1",children:[i.jsx(X,{size:10}),i.jsx("span",{children:"End-to-End Encrypted"})]})]})},se=({user:l,onLogout:t,...r})=>{const e=async()=>{try{await D.auth.signOut(),t&&t()}catch(a){console.error("Error during logout:",a)}};return l?i.jsx("button",{className:`
        relative
        font-medium
        rounded-md
        overflow-hidden
        flex items-center justify-center
        bg-cyberdark-800
        text-cybergold-400
        hover:text-cybergold-300
        hover:bg-cyberdark-700
        border border-cyberdark-700
        transition-all duration-200
        ${r.size==="sm"?"py-1.5 px-3 text-sm":r.size==="lg"?"py-2.5 px-6 text-lg":"py-2 px-4 text-base"}
        ${r.fullWidth?"w-full":""}
        ${r.className||""}
      `,onClick:e,title:"Sign out from Snakkaz Chat",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.showIcon&&i.jsx(X,{size:r.size==="sm"?14:r.size==="lg"?20:16}),i.jsx("span",{children:"Sign Out"})]})}):i.jsx(Ze,{...r})},Z={fadeIn:"animate-[fadeIn_0.3s_ease-in-out]",slideIn:"animate-[slideIn_0.3s_ease-in-out]"},Qe=`
  transition-all duration-200 
  hover:bg-opacity-20 hover:bg-primary 
  hover:shadow-lg
  hover:scale-[1.02]
  hover:translate-x-[2px]
  hover:border-cybergold-500
`,Xe=`
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slideIn {
    from { transform: translateY(10px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  @keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
`,pt=({onGroupSelect:l})=>{const{groups:t,currentGroup:r,setCurrentGroup:e,createGroup:a,currentUser:n}=qe(),[s,o]=f.useState(!1),[c,d]=f.useState(""),[y,u]=f.useState(b.ENHANCED),[p,x]=f.useState(!1),[E,v]=f.useState(""),[F,L]=f.useState(!0);f.useEffect(()=>{if(typeof document<"u"){const m="snakkaz-group-animations";if(!document.getElementById(m)){const G=document.createElement("style");G.id=m,G.textContent=Xe,document.head.appendChild(G)}const K=setTimeout(()=>L(!1),1e3);return()=>clearTimeout(K)}},[]);const Y=async()=>{if(c.trim())try{x(!0);const m=await a(c,{securityLevel:y,isPrivate:!0,allowMemberInvites:!1});e(m),d(""),u(b.ENHANCED),o(!1)}catch(m){console.error("Failed to create group:",m)}finally{x(!1)}},U=t.filter(m=>m.settings.name.toLowerCase().includes(E.toLowerCase()));return i.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-b from-cyberdark-950 to-cyberdark-900 border-r border-cyberdark-700",children:[i.jsxs("div",{className:"p-4 border-b border-cyberdark-800 bg-cyberdark-900 bg-opacity-70",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsxs("h2",{className:"font-medium text-cybergold-100 flex items-center gap-2",children:[i.jsx(Pe,{size:18,className:"text-cybergold-500"}),i.jsx("span",{children:"Krypterte Samtaler"})]}),i.jsx("div",{className:"ml-auto",children:i.jsx(se,{user:n,size:"sm",variant:"ghost",showIcon:!0,onLogout:()=>{e(null)}})})]}),i.jsxs("div",{className:"relative mb-3",children:[i.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-cybergold-500",size:16}),i.jsx(te,{placeholder:"SÃ¸k etter samtaler...",value:E,onChange:m=>v(m.target.value),className:"pl-9 bg-cyberdark-800 border-cyberdark-700 text-cybergold-200 placeholder:text-cybergold-600",disabled:!n})]}),n?i.jsxs(W,{size:"sm",variant:"outline",className:"border-cybergold-700 text-cybergold-300 w-full hover:bg-cybergold-900 hover:text-cybergold-100 flex items-center justify-center gap-2",onClick:()=>o(!0),children:[i.jsx(Re,{size:16,className:"mr-1"})," Ny"]}):i.jsx("div",{className:"text-center text-cybergold-400 text-sm py-2",children:"Logg inn for Ã¥ opprette samtaler"})]}),i.jsx("div",{className:"flex-grow overflow-y-auto p-2",children:n?t.length===0?i.jsx("div",{className:`p-4 text-center text-cybergold-400 text-sm rounded-lg my-4 mx-2 bg-cyberdark-800 bg-opacity-50 border border-dashed border-cyberdark-700 ${Z.fadeIn}`,children:"Ingen samtaler funnet. Opprett en ny samtale for Ã¥ starte."}):U.length===0?i.jsxs("div",{className:`p-4 text-center text-cybergold-400 text-sm rounded-lg my-4 mx-2 bg-cyberdark-800 bg-opacity-50 border border-dashed border-cyberdark-700 ${Z.fadeIn}`,children:["Ingen samtaler funnet med sÃ¸ket: ",i.jsx("span",{className:"font-medium text-cybergold-300",children:E})]}):i.jsx("div",{className:"space-y-2",children:U.map((m,K)=>i.jsx("div",{className:`rounded-lg p-3 mb-2 cursor-pointer transition-all duration-200 border border-transparent ${F?Z.slideIn:""} ${Qe} ${(r==null?void 0:r.id)===m.id?"bg-gradient-to-r from-cybergold-900/30 to-cyberdark-800 border-l-2 border-cybergold-600":"hover:bg-cyberdark-800 hover:border-l-2 hover:border-cybergold-800"}`,style:{animationDelay:`${K*50}ms`},onClick:()=>{e(m),l&&l(m)},children:i.jsxs("div",{className:"flex items-center",children:[i.jsx($e,{className:"w-10 h-10 mr-3 ring-1 ring-offset-1 ring-offset-background ring-cybergold-800",children:i.jsx("div",{className:`bg-gradient-to-br from-cyberblue-800 to-cyberblue-600 w-full h-full flex items-center justify-center text-white font-medium ${(r==null?void 0:r.id)===m.id?"scale-110 transition-transform duration-300":""}`,children:m.settings.name.charAt(0)})}),i.jsxs("div",{className:"flex-grow overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-medium text-cybergold-100 truncate",children:m.settings.name}),i.jsx("div",{className:`ml-1 px-2 py-0.5 rounded-full text-xs ${m.settings.securityLevel===b.PREMIUM?"bg-gradient-to-r from-cybergold-700 to-cybergold-500 text-black":m.settings.securityLevel===b.ENHANCED?"bg-blue-900 text-blue-100":"bg-gray-800 text-gray-200"}`,children:m.settings.securityLevel===b.PREMIUM?i.jsxs("span",{className:"flex items-center",children:[i.jsx(X,{size:10,className:"mr-1"})," Premium"]}):m.settings.securityLevel===b.ENHANCED?"Forbedret":"Standard"})]}),i.jsxs("div",{className:"flex items-center text-xs text-cybergold-400",children:[i.jsx(Oe,{size:12,className:"mr-1"}),i.jsxs("span",{className:"truncate",children:[m.members.length," medlemmer"]}),i.jsx("span",{className:"mx-1",children:"â€¢"}),i.jsx("span",{className:"text-cybergold-500",children:Te(m.createdAt,"dd.MM.yyyy")})]})]})]})},m.id))}):i.jsx("div",{className:"flex flex-col items-center justify-center h-full p-6",children:i.jsxs("div",{className:"bg-cyberdark-800 bg-opacity-70 border border-cyberdark-700 rounded-xl p-6 text-center max-w-md mx-auto",children:[i.jsx(de,{size:48,className:"text-cybergold-500 mx-auto mb-4"}),i.jsx("h3",{className:"text-xl font-bold text-cybergold-100 mb-2",children:"Sikre samtaler med Snakkaz"}),i.jsx("p",{className:"text-sm text-cybergold-300 mb-4",children:"Logg inn for Ã¥ fÃ¥ tilgang til ende-til-ende krypterte samtaler med full sikkerhet."}),i.jsx("div",{className:"mt-4",children:i.jsx(se,{user:n,size:"lg",fullWidth:!0,className:"mx-auto"})})]})})}),i.jsx(xe,{open:s,onOpenChange:o,children:i.jsxs(ve,{className:"bg-cyberdark-900 border-cybergold-900/50",children:[i.jsx(Se,{children:i.jsx(De,{className:"text-cybergold-100",children:"Opprett ny gruppe"})}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(re,{htmlFor:"name",children:"Gruppenavn"}),i.jsx(te,{id:"name",value:c,onChange:m=>d(m.target.value),placeholder:"Skriv inn gruppenavn",className:"border-cyberdark-600 bg-cyberdark-800"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(re,{htmlFor:"security-level",children:"SikkerhetsnivÃ¥"}),i.jsxs(Ne,{value:y,onValueChange:u,children:[i.jsx(Ie,{className:"border-cyberdark-600 bg-cyberdark-800",id:"security-level",children:i.jsx(_e,{placeholder:"Velg sikkerhetsnivÃ¥"})}),i.jsxs(Me,{className:"bg-cyberdark-800 border-cyberdark-600",children:[i.jsx(q,{value:b.STANDARD,children:i.jsx("div",{className:"flex items-center",children:"Standard"})}),i.jsx(q,{value:b.ENHANCED,children:i.jsx("div",{className:"flex items-center",children:"Forbedret ðŸ”’"})}),i.jsx(q,{value:b.PREMIUM,children:i.jsx("div",{className:"flex items-center",children:"Premium ðŸ”’"})})]})]}),i.jsx("p",{className:"text-xs text-cybergold-400 mt-1",children:y===b.PREMIUM?"Premium: Ende-til-ende-kryptering for meldinger og media med automatisk nÃ¸kkelrotasjon.":y===b.ENHANCED?"Forbedret: Ende-til-ende-kryptering for meldinger.":"Standard: Grunnleggende serverkryptering."})]})]}),i.jsxs(Ae,{children:[i.jsx(W,{variant:"ghost",onClick:()=>o(!1),disabled:p,children:"Avbryt"}),i.jsx(W,{onClick:Y,disabled:!c.trim()||p,children:p?i.jsxs(i.Fragment,{children:[i.jsx(ce,{size:16,className:"mr-2 animate-spin"}),"Oppretter..."]}):i.jsx(i.Fragment,{children:"Opprett gruppe"})})]})]})})]})};export{pt as GroupList};
